<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicadores de Gesti√≥n Localidad de Santa F√©</title>
    
    <!-- Plotly.js para gr√°ficas -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Leaflet Omnivore plugin para KML -->
    <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
    
    <!-- Lightbox2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css" rel="stylesheet" />
    <!-- Lightbox2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>

    <style>
        :root {
            /* Colores principales */
            --primary-yellow: #fab62d;    /* Amarillo principal */
            --primary-red: #e4032e;       /* Rojo principal */
            --white: #ffffff;             /* Blanco */
            --dark-gray: #333333;         /* Gris oscuro */
            --light-gray: #f5f5f5;        /* Gris claro */
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--white);
            color: var(--dark-gray);
            line-height: 1.6;
        }

        .header {
            background: var(--primary-red);
            color: var(--white);
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .controls {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            border: 2px solid var(--light-gray);
        }

        .refresh-btn {
            background: linear-gradient(135deg, var(--primary-yellow) 0%, var(--primary-red) 100%);
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2.5rem; /* M√°s espacio entre gr√°ficas */
            margin-bottom: 2.5rem;
        }
        .stat-card {
            background: var(--white);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            border: 2px solid var(--light-gray);
            transition: transform 0.2s;
            margin-bottom: 2.5rem; /* M√°s espacio entre tarjetas */
        }
        /* Espacio extra debajo de la fila de tortas */
        .stats-grid + .stat-card {
            margin-top: 2.5rem;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: var(--primary-red);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            color: var(--dark-gray);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .stat-card .icon {
            font-size: 2rem;
            color: var(--primary-yellow);
            margin-bottom: 1rem;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .chart-container {
            background: var(--white);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 2px solid var(--light-gray);
        }

        .chart-title {
            color: var(--dark-gray);
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-bottom: 3px solid var(--primary-yellow);
            padding-bottom: 0.5rem;
        }

        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--dark-gray);
        }

        .loading i {
            font-size: 3rem;
            color: var(--primary-yellow);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: var(--primary-red);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-red);
            margin: 1rem 0;
            font-weight: 500;
        }

        .data-table {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-top: 2rem;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        .data-table th {
            background: var(--primary-red);
            color: var(--white);
            font-weight: 600;
        }

        .data-table tr:hover {
            background: var(--light-gray);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .menu-btn { 
            position: fixed;
            top: 1.5rem; 
            left: 2rem; 
            background: var(--primary-red); 
            border: none; 
            color: var(--white); 
            font-size: 2rem; 
            cursor: pointer; 
            z-index: 2001;
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-width: 120px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.10);
        }
        
        .menu-btn-text {
            font-size: 1.1rem;
            font-weight: 600;
            display: inline-block;
            white-space: nowrap;
        }
        .side-menu { position: fixed; top: 0; left: -280px; width: 260px; height: 100vh; background: var(--white); box-shadow: 2px 0 12px rgba(0,0,0,0.12); transition: left 0.3s cubic-bezier(.4,0,.2,1); z-index: 1200; display: flex; flex-direction: column; }
        .side-menu.open { left: 0; }
        .side-menu-header { display: flex; justify-content: space-between; align-items: center; padding: 1.2rem 1.5rem 1.2rem 1.5rem; background: var(--primary-red); color: var(--white); font-weight: 700; font-size: 1.2rem; }
        .close-menu { background: transparent; border: none; color: var(--white); font-size: 1.5rem; cursor: pointer; }
        .side-menu ul { list-style: none; padding: 0; margin: 0; }
        .side-menu li { padding: 1rem 1.5rem; border-bottom: 1px solid var(--light-gray); color: var(--dark-gray); cursor: pointer; transition: background 0.2s; }
        .side-menu li:hover { background: var(--light-gray); }
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.2); z-index: 1100; display: none; }
        .menu-overlay.open { display: block; }
        @media (max-width: 768px) { 
            .header h1 { font-size: 2rem; } 
            .container { padding: 1rem; } 
            .controls { flex-direction: column; align-items: stretch; } 
            .stats-grid { grid-template-columns: 1fr; } 
            .menu-btn { 
                top: 1rem; 
                left: 1rem; 
                font-size: 1.7rem; 
                padding: 0.5rem 1rem;
                min-width: auto;
                border-radius: 50%;
                width: 48px;
                height: 48px;
            } 
            .menu-btn-text {
                display: none;
            }
            .side-menu { width: 80vw; min-width: 180px; max-width: 320px; } 
        }
        .side-menu ul li:hover {
            background-color: var(--light-gray);
        }
    </style>
</head>
<body>
    <header class="header">
        <!-- Bot√≥n hamburguesa flotante -->
        <button id="menu-btn" class="menu-btn" aria-label="Abrir men√∫">
            <i class="fas fa-bars"></i>
            <span class="menu-btn-text">Men√∫</span>
        </button>
        <!-- Overlay antes del men√∫ lateral -->
        <div id="menu-overlay" class="menu-overlay"></div>
        <!-- Men√∫ lateral -->
        <nav id="side-menu" class="side-menu">
            <div class="side-menu-header">
                <!-- <span>Navegaci√≥n</span> -->
                <!-- Bot√≥n de cerrar eliminado -->
            </div>
            <ul id="menu-options" style="margin-top: 70px;">
                <li><a href="/" class="active">Inicio</a></li>
                <li><a href="/san-bernardo"><i class="fas fa-map-marker-alt"></i> Barrio San Bernardo</a></li>
                <li><a href="/el-consuelo"><i class="fas fa-map-marker-alt"></i> Barrio El Consuelo</a></li>
                <li><a href="/convenio-interadministrativo-302"><i class="fas fa-file-contract"></i> Convenio Interadministrativo 302</a></li>
            </ul>
        </nav>
        <div class="header-content">
            <h1><i class="fas fa-chart-line"></i> Indicadores de Gesti√≥n Localidad Santa Fe</h1>
            <p>Gesti√≥n de datos del barrio El Consuelo</p>
        </div>
    </header>

    <div class="container">
        <div class="controls">
            <div>
                <h2><i class="fas fa-dashboard"></i> Dashboard de Indicadores</h2>
                <p>Monitoreo de actividades y participaci√≥n en el Barrio El Consuelo</p>
            </div>
            <button class="refresh-btn" onclick="loadData()">
                <i class="fas fa-sync-alt"></i>
                Actualizar Datos
            </button>
        </div>

        <!-- Indicador principal arriba del mapa -->
        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); align-items: stretch;">
            <div class="stat-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <div class="icon"><i class="fas fa-poll"></i></div>
                <h3>{{ num_encuestas }}</h3>
                <p>Encuestas realizadas</p>
            </div>
            <div class="stat-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff;">
                <div class="icon"><i class="fas fa-map-marker-alt" style="color:var(--primary-red);"></i></div>
                <h3 style="color:var(--primary-red);">4<span style="color:#888; font-size:1.2rem;">/13</span></h3>
                <p style="font-size:1.1rem; color:#333;">Puntos cr√≠ticos Intervenidos</p>
            </div>
            <!-- Nuevo indicador: Indicadores de gesti√≥n en residuos -->
            <div id="btn-indicadores-gestion" class="stat-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; cursor:pointer;">
                <div class="icon"><i class="fas fa-recycle" style="color:var(--primary-red);"></i></div>
                <h3 style="color:var(--primary-red); font-size:2.5rem; font-weight:700;">4</h3>
                <p style="font-size:1.1rem; color:#333;">Hojas de vida de Indicadores de gesti√≥n de residuos</p>
            </div>
            <!-- Nuevo indicador: Ruta Metodol√≥gica -->
            <div id="btn-ruta-metodologica" class="stat-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; cursor:pointer;">
                <div class="icon"><i class="fas fa-route" style="color:var(--primary-red);"></i></div>
                <h3 style="color:var(--primary-red); font-size:2.5rem; font-weight:700;">1</h3>
                <p style="font-size:1.1rem; color:#333;">Ruta Metodol√≥gica</p>
            </div>
            <!-- Nuevo indicador: Caja de Herramientas -->
            <div id="btn-caja-herramientas" class="stat-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; cursor:pointer;">
                <div class="icon"><i class="fas fa-toolbox" style="color:var(--primary-red);"></i></div>
                <h3 style="color:var(--primary-red); font-size:2.5rem; font-weight:700;">1</h3>
                <p style="font-size:1.1rem; color:#333;">Caja de Herramientas</p>
            </div>
            <!-- Nuevo indicador: Plan de Trabajo -->
            <div id="btn-plan-trabajo" class="stat-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; cursor:pointer;">
                <div class="icon"><i class="fas fa-clipboard-list" style="color:var(--primary-red);"></i></div>
                <h3 style="color:var(--primary-red); font-size:2.5rem; font-weight:700;">2</h3>
                <p style="font-size:1.1rem; color:#333;">Planes de trabajo</p>
            </div>
            <!-- Nuevo indicador: An√°lisis del ejercicio -->
            <div id="btn-analisis-ejercicio" class="stat-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; cursor:pointer;">
                <div class="icon"><i class="fas fa-chart-bar" style="color:var(--primary-red);"></i></div>
                <h3 style="color:var(--primary-red); font-size:2.5rem; font-weight:700;">1</h3>
                <p style="font-size:1.1rem; color:#333;">An√°lisis del ejercicio</p>
            </div>
            <!-- Nuevo indicador: 4 comportamientos de indicadores de gesti√≥n -->
            <div id="btn-comportamientos-indicadores" class="stat-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; cursor:pointer; margin-left: 1.5rem;">
                <div class="icon"><i class="fas fa-layer-group" style="color:var(--primary-red);"></i></div>
                <h3 style="color:var(--primary-red); font-size:2.5rem; font-weight:700;">4</h3>
                <p style="font-size:1.1rem; color:#333;">Comportamientos de indicadores de gesti√≥n</p>
            </div>
        </div>

        <!-- T√≠tulo de georreferenciaci√≥n -->
        <h2 style="margin-top: 2rem; margin-bottom: 1rem; text-align:center; color: var(--primary-red); font-size: 1.6rem; font-weight: 700;">Georreferenciaci√≥n de los puntos cr√≠ticos</h2>

        <!-- Toggle para mostrar/ocultar puntos cr√≠ticos -->
        <div style="text-align:center; margin-bottom: 1rem;">
            <label style="font-weight:600; font-size:1.1rem; margin-right:2em;">
                <input type="checkbox" id="toggle-puntos-criticos" style="margin-right:0.5em; transform: scale(1.3); vertical-align:middle;"> Mostrar puntos cr√≠ticos en el mapa
            </label>
            <label style="font-weight:600; font-size:1.1rem; margin-right:2em;">
                <input type="checkbox" id="toggle-puntos-intervenidos" style="margin-right:0.5em; transform: scale(1.3); vertical-align:middle;"> Puntos cr√≠ticos intervenidos
            </label>
            <label style="font-weight:600; font-size:1.1rem;">
                <input type="checkbox" id="toggle-bateria-social" style="margin-right:0.5em; transform: scale(1.3); vertical-align:middle;"> Bater√≠a social
            </label>
        </div>

        <!-- Bot√≥n para resaltar pol√≠gonos intervenidos -->
        <div style="text-align:center; margin-bottom: 1rem;">
            <button id="btn-resaltar-poligonos" style="background: #ffe066; color: #333; border: 2px solid #fab62d; border-radius: 8px; padding: 0.7em 1.5em; font-weight: 700; font-size: 1.1rem; cursor: pointer; margin-top: 0.5em;">Resaltar pol√≠gonos intervenidos</button>
        </div>

        <!-- Mapa de El Consuelo -->
        <div id="map" style="width: 100%; height: 500px; margin: 2rem 0; border-radius: 12px; box-shadow: var(--shadow);"></div>

        <!-- T√≠tulo de informaci√≥n general -->
        <h2 id="titulo-resultados-encuestas" style="margin-top: 1.5rem; margin-bottom: 1rem; text-align:center; color: var(--primary-red); font-size: 1.6rem; font-weight: 700;">Resultados generales de las encuestas</h2>

        <!-- Gr√°ficas de torta debajo del mapa -->
        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); align-items: stretch;">
            <div class="stat-card">
                <div class="chart-title" style="text-align:center; font-weight:600; margin-bottom:0.5rem;">Nivel educativo</div>
                <div id="nivelPie" style="height: 220px;"></div>
                <div style="text-align:center; font-weight:600; margin-top:0.5rem;"></div>
            </div>
            <div class="stat-card">
                <div class="chart-title" style="text-align:center; font-weight:600; margin-bottom:0.5rem;">Tiempo en el barrio</div>
                <div id="tiempoPie" style="height: 220px;"></div>
                <div style="text-align:center; font-weight:600; margin-top:0.5rem;"></div>
            </div>
        </div>

        <!-- Gr√°fica de barras para limpieza general -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="limpiezaBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øC√≥mo calificar√≠a la limpieza general del barrio?</div>
        </div>
        
        <!-- Gr√°fica de barras para frecuencia de residuos -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="residuosBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øCon qu√© frecuencia observa residuos en las calles o zonas comunes?</div>
        </div>
        
        <!-- Gr√°fica de barras para afecta imagen del barrio -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="tiempoBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øConsidera que la acumulaci√≥n de residuos afecta la imagen del barrio?</div>
        </div>
        
        <!-- Gr√°fica de barras para residuos y seguridad -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="seguridadBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øConsidera que el tema de residuos est√° relacionado con el tema de seguridad del barrio?</div>
        </div>
        
        <!-- Gr√°fica de barras para afecta calidad de vida -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="calidadVidaBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øConsidera que la acumulaci√≥n de residuos afecta su calidad de vida?</div>
        </div>
        
        <!-- Gr√°fica de barras para separaci√≥n de residuos -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="separacionBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øSepara los residuos en su casa (org√°nicos, reciclables, no reciclables)?</div>
        </div>
        
        <!-- Gr√°fica de barras para conoce horario recolecci√≥n -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="horarioBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øConoce el horario de recolecci√≥n de residuos en el barrio?</div>
        </div>
        
        <!-- Gr√°fica de barras para saca residuos en horarios -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="sacaHorariosBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øSaca los residuos en los horarios establecidos?</div>
        </div>
        
        <!-- Gr√°fica de barras para entrega a recuperador -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="recuperadorBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øEntrega sus residuos aprovechables a un recuperador de oficio?</div>
        </div>
        
        <!-- Gr√°fica de barras para lugar de disposici√≥n -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="lugarBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øEn qu√© lugar dispone los residuos?</div>
        </div>
        
        <!-- Gr√°fica de barras para calificaci√≥n del servicio -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="servicioBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øC√≥mo calificar√≠a la operaci√≥n del servicio de aseo de Promoambiental Distrito S.A.S?</div>
        </div>
        
        <!-- Gr√°fica de barras para frecuencia cami√≥n recolector -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="frecuenciaCamionBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øCon qu√© frecuencia pasa el cami√≥n recolector de residuos?</div>
        </div>
        
        <!-- Gr√°fica de barras para participaci√≥n en campa√±as -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="participacionBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øHa participado en alguna campa√±a de limpieza o educaci√≥n ambiental en su barrio?</div>
        </div>
        
        <!-- Gr√°fica de barras para iniciativas comunitarias -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="iniciativasBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øLe gustar√≠a participar en iniciativas comunitarias de limpieza?</div>
        </div>
        
        <!-- Gr√°fica de barras para educaci√≥n ambiental -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="educacionBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øConsidera que hace falta m√°s educaci√≥n ambiental en el barrio?</div>
        </div>
        
        <!-- Gr√°fica de barras para sabe punto cr√≠tico -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="puntoCriticoBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øSabe que es un punto cr√≠tico?</div>
        </div>
        
        <!-- Gr√°fica de barras para identifica puntos cr√≠ticos -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="identificaBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øIdentifica puntos cr√≠ticos en el barrio?</div>
        </div>
        
        <!-- Gr√°fica de barras para tiempo puntos cr√≠ticos -->
        <div class="stat-card" style="margin: 2rem auto; max-width: 800px;">
            <div id="tiempoPuntosBar" style="height: 300px;"></div>
            <div style="text-align:center; font-weight:600; margin-top:0.5rem;">¬øCada cuanto tiempo ve estos puntos en el barrio?</div>
        </div>
        


        <!-- Eliminado: Gr√°ficas de barras categ√≥ricas y su JS asociado -->
        <!-- Fin de eliminaci√≥n -->

        <div class="charts-grid">
            
        </div>
    </div>

    <!-- Modal para Hojas de vida de Indicadores de gesti√≥n de residuos -->
    <div id="indicadoresModal" class="modal-indicadores" style="display:none;">
      <div class="modal-content-indicadores">
        <span class="close-modal-indicadores" id="closeIndicadoresModal">&times;</span>
        <h2 style="color:var(--primary-red); text-align:center; margin-bottom:1.5rem;">Hojas de vida de Indicadores de gesti√≥n de residuos</h2>
        <ul style="list-style:none; padding:0; font-size:1.2rem;">
          <li style="margin-bottom:1rem;">
  <button class="acordeon-indicador" id="btn-percepcion-limpieza" style="background:none; border:none; color:inherit; font:inherit; cursor:pointer; display:flex; align-items:center; gap:8px; font-size:1.2rem;">
    <i class="fas fa-broom" style="color:var(--primary-yellow);"></i> Percepci√≥n sobre la limpieza del barrio
    <span id="icono-acordeon-limpieza" style="margin-left:8px;">&#9660;</span>
  </button>
  <div id="contenido-percepcion-limpieza" style="display:none; margin-top:1rem; font-size:1rem; background:#f9f9f9; border-radius:8px; padding:1rem; border:1px solid #eee; max-height:320px; overflow-y:auto;">
    ‚úÖ <b>Nombre del indicador:</b><br>
    √çndice de Percepci√≥n Negativa sobre la Limpieza del Barrio (IPNLB)
    <br><br>
    üéØ <b>Objetivo:</b><br>
    Medir el porcentaje de personas que tienen una percepci√≥n negativa sobre la limpieza del barrio, a partir de sus respuestas a las preguntas 11 a 15.
    <br><br>
    üßÆ <b>F√≥rmula del indicador:</b><br>
    <code>IPNLB (%) = (N¬∞ de personas con percepci√≥n negativa / Total de encuestados) √ó 100</code>
    <br><br>
    üìå <b>Criterios para considerar una percepci√≥n negativa (puntaje):</b><br>
    <table style="width:100%; border-collapse:collapse; margin:8px 0;">
      <tr style="background:#eee;">
        <th style="padding:4px; border:1px solid #ddd;">Pregunta</th>
        <th style="padding:4px; border:1px solid #ddd;">Respuestas consideradas negativas</th>
        <th style="padding:4px; border:1px solid #ddd;">Puntaje</th>
      </tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">11</td><td style="padding:4px; border:1px solid #ddd;">Calificaci√≥n 1 o 2</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">12</td><td style="padding:4px; border:1px solid #ddd;">Frecuentemente o Siempre</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">13</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">14</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">15</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
    </table>
    üìä <b>Puntaje total posible:</b> 0 a 5<br>
    <b>Umbral para percepci√≥n negativa:</b> Se considera percepci√≥n negativa cuando el puntaje es igual 3 o menor a este<br>
    <code>IPNLB = (58 / 100) √ó 100 = 58%</code>
    <br><br>
    üìã <b>Ficha t√©cnica resumida del indicador:</b><br>
    <b>Nombre:</b> √çndice de Percepci√≥n Negativa sobre la Limpieza del Barrio (IPNLB)<br>
    <b>Tipo:</b> Percepci√≥n ciudadana<br>
    <b>Unidad de medida:</b> Porcentaje (%)<br>
    <b>Fuente de informaci√≥n:</b> Encuesta de percepci√≥n<br>
    <b>Frecuencia de medici√≥n:</b> Trimestral / semestral / anual (seg√∫n tu necesidad)<br>
    <b>Interpretaci√≥n:</b> Un valor menor indica una percepci√≥n m√°s negativa de la limpieza del barrio.
  </div>
</li>
<li style="margin-bottom:1rem;">
  <button class="acordeon-indicador" id="btn-habitos-residuos" style="background:none; border:none; color:inherit; font:inherit; cursor:pointer; display:flex; align-items:center; gap:8px; font-size:1.2rem;">
    <i class="fas fa-user-check" style="color:var(--primary-yellow);"></i> H√°bitos personales de manejo de residuos
    <span id="icono-acordeon-habitos" style="margin-left:8px;">&#9660;</span>
  </button>
  <div id="contenido-habitos-residuos" style="display:none; margin-top:1rem; font-size:1rem; background:#f9f9f9; border-radius:8px; padding:1rem; border:1px solid #eee; max-height:320px; overflow-y:auto;">
    üßæ <b>Hoja de vida del indicador</b><br>
    <b>Nombre del indicador:</b><br>
    √çndice de Buenas Pr√°cticas en la Gesti√≥n de Residuos (IBPGR)
    <br><br>
    <b>Objetivo del indicador:</b><br>
    Medir el nivel de adopci√≥n de buenas pr√°cticas ciudadanas frente a la separaci√≥n, disposici√≥n y entrega adecuada de residuos s√≥lidos domiciliarios.
    <br><br>
    <b>Tipo de indicador:</b><br>
    Comportamiento ‚Äì Ambiental ‚Äì Ciudadano
    <br><br>
    <b>Unidad de medida:</b><br>
    Porcentaje (%)
    <br><br>
    <b>F√≥rmula:</b><br>
    <code>IBPGR (%) = (N¬∞ de personas con pr√°cticas adecuadas (puntaje ‚â• 4) / Total de encuestados) √ó 100</code>
    <br><br>
    <b>Preguntas e interpretaci√≥n de respuestas positivas (buenas pr√°cticas):</b><br>
    <table style="width:100%; border-collapse:collapse; margin:8px 0;">
      <tr style="background:#eee;">
        <th style="padding:4px; border:1px solid #ddd;">Pregunta</th>
        <th style="padding:4px; border:1px solid #ddd;">Respuesta considerada buena pr√°ctica</th>
        <th style="padding:4px; border:1px solid #ddd;">Puntaje</th>
      </tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">16. ¬øSepara los residuos?</td><td style="padding:4px; border:1px solid #ddd;">Siempre</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">17. ¬øConoce el horario de recolecci√≥n?</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">18. ¬øSaca los residuos en horarios?</td><td style="padding:4px; border:1px solid #ddd;">Siempre</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">19. ¬øEntrega a recuperador de oficio?</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">0. ¬øD√≥nde los dispone?</td><td style="padding:4px; border:1px solid #ddd;">Frente de su casa</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">21. ¬øQu√© hace si no hay recolecci√≥n?</td><td style="padding:4px; border:1px solid #ddd;">Espera hasta el d√≠a de recolecci√≥n</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
    </table>
    <b>Puntaje total posible:</b> 0 a 6<br>
    <b>Se considera buenas pr√°cticas si el encuestado obtiene 4 puntos o m√°s.</b>
    <br><br>
    <b>Periodicidad de medici√≥n:</b><br>
    Trimestral, semestral o anual (seg√∫n disponibilidad de encuesta)
    <br><br>
    <b>Fuente de datos:</b><br>
    Encuesta de percepci√≥n y comportamiento ciudadano
    <br><br>
    <b>Interpretaci√≥n del indicador:</b><br>
    0‚Äì40%: Bajo nivel de buenas pr√°cticas<br>
    41‚Äì70%: Nivel medio<br>
    71‚Äì100%: Buen nivel de adopci√≥n de pr√°cticas responsables
    <br><br>
    <b>Ejemplo de aplicaci√≥n (con datos simulados):</b><br>
    Total encuestados: 349<br>
    Personas con 4 o m√°s respuestas positivas: 197<br>
    <code>IBPGR = (197 / 349) √ó 100 = 56.44%</code><br>
    El 56.44% de los encuestados demuestra buenas pr√°cticas en la gesti√≥n de residuos en su entorno.
  </div>
</li>
<li style="margin-bottom:1rem;">
  <button class="acordeon-indicador" id="btn-opinion-recoleccion" style="background:none; border:none; color:inherit; font:inherit; cursor:pointer; display:flex; align-items:center; gap:8px; font-size:1.2rem;">
    <i class="fas fa-truck" style="color:var(--primary-yellow);"></i> Opini√≥n sobre el servicio de recolecci√≥n
    <span id="icono-acordeon-recoleccion" style="margin-left:8px;">&#9660;</span>
  </button>
  <div id="contenido-opinion-recoleccion" style="display:none; margin-top:1rem; font-size:1rem; background:#f9f9f9; border-radius:8px; padding:1rem; border:1px solid #eee; max-height:320px; overflow-y:auto;">
    <b>Nombre del indicador:</b><br>
    √çndice de Satisfacci√≥n con el Servicio de Recolecci√≥n (ISSR)
    <br><br>
    <b>Objetivo del indicador:</b><br>
    Medir el nivel de satisfacci√≥n de la comunidad con la operaci√≥n del servicio de aseo prestado por Promoambiental Distrito S.A.S, en cuanto a calidad percibida y conocimiento de la frecuencia de recolecci√≥n.
    <br><br>
    <b>Tipo de indicador:</b><br>
    Percepci√≥n ‚Äì Servicio p√∫blico
    <br><br>
    <b>Unidad de medida:</b><br>
    Porcentaje (%)
    <br><br>
    <b>F√≥rmula:</b><br>
    <code>ISSR (%) = (N¬∞ de personas satisfechas (puntaje ‚â• 2) / Total de encuestados) √ó 100</code>
    <br><br>
    <b>Preguntas e interpretaci√≥n de respuestas positivas (satisfacci√≥n):</b><br>
    <table style="width:100%; border-collapse:collapse; margin:8px 0;">
      <tr style="background:#eee;">
        <th style="padding:4px; border:1px solid #ddd;">Pregunta</th>
        <th style="padding:4px; border:1px solid #ddd;">Respuesta considerada satisfactoria</th>
        <th style="padding:4px; border:1px solid #ddd;">Puntaje</th>
      </tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">22. ¬øC√≥mo califica la operaci√≥n del servicio?</td><td style="padding:4px; border:1px solid #ddd;">Calificaci√≥n 4 o 5</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">23. ¬øConoce la frecuencia del cami√≥n?</td><td style="padding:4px; border:1px solid #ddd;">martes, jueves y sabado</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
    </table>
    <b>Puntaje total posible:</b> 0 a 2<br>
    <b>Se considera satisfacci√≥n si el encuestado obtiene 2 puntos.</b>
    <br><br>
    <b>Periodicidad de medici√≥n:</b><br>
    Trimestral, semestral o anual
    <br><br>
    <b>Fuente de datos:</b><br>
    Encuesta de percepci√≥n ciudadana sobre servicios p√∫blicos
    <br><br>
    <b>Interpretaci√≥n del indicador:</b><br>
    0‚Äì40%: Bajo nivel de satisfacci√≥n<br>
    41‚Äì70%: Nivel medio<br>
    71‚Äì100%: Alto nivel de satisfacci√≥n
    <br><br>
    <b>Ejemplo de aplicaci√≥n (con datos simulados):</b><br>
    Total encuestados: 349<br>
    Personas con 2 puntos: 248<br>
    <code>ISSR = (248 / 349) √ó 100 = 71.06%</code><br>
    El 71.06% de los encuestados est√° satisfecho con el servicio de recolecci√≥n de residuos de Promoambiental Distrito S.A.S.
  </div>
</li>
<li>
  <button class="acordeon-indicador" id="btn-participacion-educacion" style="background:none; border:none; color:inherit; font:inherit; cursor:pointer; display:flex; align-items:center; gap:8px; font-size:1.2rem;">
    <i class="fas fa-chalkboard-teacher" style="color:var(--primary-yellow);"></i> Participaci√≥n y educaci√≥n ambiental
    <span id="icono-acordeon-participacion" style="margin-left:8px;">&#9660;</span>
  </button>
  <div id="contenido-participacion-educacion" style="display:none; margin-top:1rem; font-size:1rem; background:#f9f9f9; border-radius:8px; padding:1rem; border:1px solid #eee; max-height:320px; overflow-y:auto;">
    <b>Hoja de vida del indicador</b><br>
    <b>Nombre del indicador:</b><br>
    √çndice de Participaci√≥n y Educaci√≥n Ambiental (IPEA)
    <br><br>
    <b>Objetivo del indicador:</b><br>
    Medir el nivel de participaci√≥n, disposici√≥n e informaci√≥n de la ciudadan√≠a frente a temas de educaci√≥n ambiental y conocimiento de problem√°ticas locales como los puntos cr√≠ticos de residuos.
    <br><br>
    <b>Tipo de indicador:</b><br>
    Participaci√≥n ‚Äì Ambiental ‚Äì Educativo
    <br><br>
    <b>Unidad de medida:</b><br>
    Porcentaje (%)
    <br><br>
    <b>F√≥rmula del indicador:</b><br>
    <code>IPEA (%) = (N¬∞ de personas con puntaje ‚â• 4 / Total de encuestados) √ó 100</code>
    <br><br>
    <b>Preguntas y criterios de evaluaci√≥n:</b><br>
    <table style="width:100%; border-collapse:collapse; margin:8px 0;">
      <tr style="background:#eee;">
        <th style="padding:4px; border:1px solid #ddd;">Pregunta</th>
        <th style="padding:4px; border:1px solid #ddd;">Respuesta positiva o esperada</th>
        <th style="padding:4px; border:1px solid #ddd;">Puntaje</th>
      </tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">24. ¬øHa participado en campa√±as?</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">25. ¬øLe gustar√≠a participar?</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">26. ¬øHace falta m√°s educaci√≥n ambiental?</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">27. ¬øSabe qu√© es un punto cr√≠tico?</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">28. ¬øIdentifica puntos cr√≠ticos en el barrio?</td><td style="padding:4px; border:1px solid #ddd;">S√≠</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
      <tr><td style="padding:4px; border:1px solid #ddd;">29. ¬øCada cu√°nto los ve?</td><td style="padding:4px; border:1px solid #ddd;">Diario o D√≠a de por medio</td><td style="padding:4px; border:1px solid #ddd;">1</td></tr>
    </table>
    <b>Puntaje total posible:</b> 0 a 6 puntos<br>
    <b>Se considera alta participaci√≥n e inter√©s ambiental si el encuestado obtiene 4 puntos o m√°s.</b>
    <br><br>
    <b>Periodicidad de medici√≥n:</b><br>
    Anual o semestral
    <br><br>
    <b>Fuente de datos:</b><br>
    Encuesta de percepci√≥n ambiental
    <br><br>
    <b>Interpretaci√≥n del indicador:</b><br>
    0‚Äì30%: Bajo nivel de participaci√≥n y conciencia ambiental<br>
    31‚Äì60%: Nivel medio<br>
    61‚Äì100%: Alto nivel de compromiso e informaci√≥n ambiental
    <br><br>
    <b>Ejemplo de aplicaci√≥n (con datos simulados):</b><br>
    Total encuestados: 349<br>
    Personas con puntaje ‚â• 4: 204<br>
    <code>IPEA = (204 / 349) √ó 100 = 58.45%</code>
  </div>
</li>
        </ul>
      </div>
    </div>

    <style>
    .modal-indicadores {
      display: none;
      position: fixed;
      z-index: 3000;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.35);
      justify-content: center;
      align-items: center;
    }
    .modal-content-indicadores {
      background: #fff;
      border-radius: 16px;
      max-width: 420px;
      margin: auto;
      padding: 2rem 2.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      position: relative;
      animation: fadeInModal .3s;
    }
    @keyframes fadeInModal {
      from { transform: translateY(-30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .close-modal-indicadores {
      position: absolute;
      top: 1rem; right: 1.5rem;
      font-size: 2rem;
      color: var(--primary-red);
      cursor: pointer;
      font-weight: bold;
      transition: color 0.2s;
    }
    .close-modal-indicadores:hover {
      color: #e4032e;
    }
    </style>

    <script>
    // --- Inicializaci√≥n del mapa ---
        var map = L.map('map').setView([4.60971, -74.08175], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '¬© OpenStreetMap'
        }).addTo(map);
        // Cargar el archivo KML de El Consuelo
        var kmlLayer = omnivore.kml('/static/data/ELCONSUELO.kml')
            .on('ready', function() {
                map.fitBounds(this.getBounds());
            })
            .addTo(map);
    // Mostrar n√∫meros en los pol√≠gonos
        let center6 = null;
        let center19 = null;
    var poligonosResaltados = false;
    var poligonosIntervenidos = ['1','2','3','4','5','6','7','8','17','22'];
    var poligonoLayers = [];
        kmlLayer.on('layeradd', function(e) {
            if (e.layer.feature && e.layer.feature.properties && e.layer.feature.properties.description) {
                var desc = e.layer.feature.properties.description;
                var match = desc.match(/<td>\s*N√∫mero Cuadrante\s*<\/td>\s*<td>(\d+)<\/td>/);
                if (match && match[1]) {
                    var num = match[1];
                // Guardar referencia a cada pol√≠gono por n√∫mero
                e.layer._cuadranteNum = num;
                poligonoLayers.push(e.layer);
                    var center = e.layer.getBounds().getCenter();
                    if (num === '6') center6 = center;
                    if (num === '19') center19 = center;
                    if (num === '5' && center6) {
                    center = L.latLng(center6.lat - 0.0003, center6.lng);
                    } else if (num === '18' && center19) {
                    center = L.latLng(center19.lat, center19.lng + 0.0004);
                    } else if (num === '18') {
                    center = L.latLng(4.58085, -74.0687);
                    }
                    L.marker(center, {
                        icon: L.divIcon({
                            className: 'polygon-label',
                            html: '<b>' + num + '</b>',
                            iconSize: [30, 30]
                        })
                    }).addTo(map);
                }
            }
        });
    document.getElementById('btn-resaltar-poligonos').addEventListener('click', function() {
        poligonosResaltados = !poligonosResaltados;
        this.textContent = poligonosResaltados ? 'Quitar resaltado de pol√≠gonos' : 'Resaltar pol√≠gonos intervenidos';
        poligonoLayers.forEach(function(layer) {
            if (poligonosIntervenidos.includes(layer._cuadranteNum)) {
                if (poligonosResaltados) {
                    layer.setStyle({fillColor: '#ffe066', color: '#fab62d', weight: 3, fillOpacity: 0.7});
                } else {
                    layer.setStyle({fillColor: '#3388ff', color: '#3388ff', weight: 2, fillOpacity: 0.2});
                }
            }
        });
    });
    // --- Puntos cr√≠ticos y puntos cr√≠ticos intervenidos ---
    // IDs de puntos intervenidos
    const puntosIntervenidosIds = ['1', '3', '6', '15'];
    let puntosCriticosMarkers = [];
    let puntosCriticosLayer = null;
    let puntosCriticosData = [];

    function renderPuntosCriticosLayer(intervenidosActivos) {
        if (puntosCriticosLayer) {
            map.removeLayer(puntosCriticosLayer);
        }
        const markers = [];
        const latlngs = [];
        for (const punto of puntosCriticosData) {
            const color = (intervenidosActivos && puntosIntervenidosIds.includes(punto.name)) ? 'green' : 'red';
            const iconUrl = color === 'green'
                ? 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png'
                : 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png';
            const marker = L.marker([punto.lat, punto.lng], {
                icon: L.divIcon({
                    className: 'custom-marker-' + color,
                    html: '<div style="position:relative; width:30px; height:41px;">' +
                          '<img src="' + iconUrl + '" style="position:absolute; left:0; top:0; width:30px; height:41px;">' +
                          '<span style="position:absolute; top:7px; left:0; width:30px; text-align:center; color:black; font-weight:bold; font-size:24px; text-shadow:1px 1px 2px #fff;">' + punto.name + '</span>' +
                          '</div>',
                    iconSize: [30, 41],
                    iconAnchor: [15, 41],
                    popupAnchor: [1, -34],
                    shadowUrl: 'https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/images/marker-shadow.png',
                    shadowSize: [41, 41]
                })
            });
            // Asociar popup con la descripci√≥n del KML
            if (punto.description) {
                marker.bindPopup(punto.description);
            } else {
                marker.bindPopup('Punto cr√≠tico ' + punto.name);
            }
            markers.push(marker);
            latlngs.push([punto.lat, punto.lng]);
        }
        puntosCriticosLayer = L.layerGroup(markers);
        puntosCriticosLayer.addTo(map);
        if (latlngs.length > 0) {
            map.fitBounds(latlngs, {padding: [50, 50]});
        }
    }

    document.getElementById('toggle-puntos-criticos').addEventListener('change', function(e) {
        if (e.target.checked) {
            if (puntosCriticosData.length === 0) {
                fetch('/static/data/puntos_criticos.kml')
                    .then(response => response.text())
                    .then(kmlText => {
                        var parser = new DOMParser();
                        var kml = parser.parseFromString(kmlText, 'text/xml');
                        var placemarks = kml.getElementsByTagName('Placemark');
                        puntosCriticosData = [];
                        for (var i = 0; i < placemarks.length; i++) {
                            var name = placemarks[i].getElementsByTagName('name')[0].textContent.trim();
                            var coords = placemarks[i].getElementsByTagName('coordinates')[0].textContent.trim().split(',');
                            var lat = parseFloat(coords[1]);
                            var lng = parseFloat(coords[0]);
                            var description = '';
                            if (placemarks[i].getElementsByTagName('description')[0]) {
                                description = placemarks[i].getElementsByTagName('description')[0].textContent.trim();
                            }
                            puntosCriticosData.push({name, lat, lng, description});
                        }
                        renderPuntosCriticosLayer(false);
                    });
            } else {
                renderPuntosCriticosLayer(false);
            }
        } else {
            if (puntosCriticosLayer) {
                map.removeLayer(puntosCriticosLayer);
            }
        }
    });

    document.getElementById('toggle-puntos-intervenidos').addEventListener('change', function(e) {
        if (e.target.checked) {
            if (puntosCriticosData.length > 0) {
                renderPuntosCriticosLayer(true);
            }
        } else {
            if (puntosCriticosData.length > 0) {
                renderPuntosCriticosLayer(false);
            }
        }
    });

    // --- Agrupador gen√©rico ---
    function agruparPorCampo(data, campo) {
        if (data && data.length > 0) {
            console.log('Campos disponibles:', Object.keys(data[0]));
        }
        const counts = {};
        data.forEach(row => {
            const valor = (row[campo] || '').trim();
            if (valor) counts[valor] = (counts[valor] || 0) + 1;
        });
        return counts;
    }

    // --- Buscar campo flexible por nombre ---
    function buscarCampo(data, posiblesNombres) {
        if (!data || data.length === 0) return null;
        const keys = Object.keys(data[0]);
        for (const nombre of posiblesNombres) {
            const key = keys.find(k => k.trim().toLowerCase() === nombre.trim().toLowerCase());
            if (key) return key;
        }
        return null;
    }

    // --- Renderizador de gr√°ficas ---
    function renderGraficasResultados(data) {
        // 1. Nivel educativo
        const nivelCounts = agruparPorCampo(data, 'Nivel educativo');
            Plotly.newPlot('nivelPie', [{
            values: Object.values(nivelCounts),
            labels: Object.keys(nivelCounts),
                type: 'pie',
                marker: {colors: ['#fab62d', '#e4032e', '#4ECDC4', '#333333', '#96CEB4', '#BB8FCE']},
                textinfo: 'percent',
                insidetextorientation: 'radial'
        }], {margin: {t: 0, b: 0, l: 0, r: 0}, showlegend: false, height: 320}, {responsive: true});

        // 2. Tiempo en el barrio
        const tiempoCounts = agruparPorCampo(data, '¬øHace cuanto tiempo reside en el barrio?');
            Plotly.newPlot('tiempoPie', [{
            values: Object.values(tiempoCounts),
            labels: Object.keys(tiempoCounts),
                type: 'pie',
                marker: {colors: ['#fab62d', '#e4032e', '#4ECDC4', '#333333', '#96CEB4', '#BB8FCE']},
                textinfo: 'percent',
                insidetextorientation: 'radial'
        }], {margin: {t: 0, b: 0, l: 0, r: 0}, showlegend: false, height: 320}, {responsive: true});

        // Helper para barras horizontales
        function renderBar(id, counts, colors, xTitle, yTitle, marginL=150) {
            const labels = Object.keys(counts);
            const values = Object.values(counts);
            const sorted = labels.map((label, i) => ({label, value: values[i], color: colors[i % colors.length]})).sort((a, b) => b.value - a.value);
            Plotly.newPlot(id, [{
                x: sorted.map(x => x.value),
                y: sorted.map(x => x.label),
                type: 'bar',
                orientation: 'h',
                marker: {color: sorted.map(x => x.color), line: {color: '#333', width: 1}},
                text: sorted.map(x => String(x.value)),
                textposition: 'auto',
                textfont: {size: 14, color: '#333'}
            }], {
                margin: {l: marginL, r: 50, t: 30, b: 50},
                height: 300,
                showlegend: false,
                xaxis: {title: xTitle, tickfont: {size: 12, color: '#333'}, gridcolor: '#e0e0e0', zeroline: false},
                yaxis: {title: yTitle, tickfont: {size: 12, color: '#333'}, gridcolor: '#e0e0e0'},
                plot_bgcolor: '#fff', paper_bgcolor: '#fff'
            }, {responsive: true});
        }
        const colores = ['#fab62d', '#e4032e', '#4ECDC4', '#333333', '#96CEB4', '#BB8FCE'];

        // 3. Limpieza general
        renderBar('limpiezaBar', agruparPorCampo(data, 'Como calificaria la limpieza general del barrio'), colores, 'N√∫mero de respuestas', 'Calificaci√≥n', 80);
        // 4. Frecuencia residuos
        renderBar('residuosBar', agruparPorCampo(data, '¬øCon qu√© frecuencia observa residuos en las calles o zonas comunes?'), colores, 'N√∫mero de respuestas', 'Frecuencia');
        // 5. Afecta imagen del barrio
        renderBar('tiempoBar', agruparPorCampo(data, '¬øConsidera que la acumulaci√≥n de residuos afecta la imagen del barrio?'), colores, 'N√∫mero de respuestas', 'Respuesta');
        // 6. Residuos y seguridad
        renderBar('seguridadBar', agruparPorCampo(data, '¬øConsidera que el tema de residuos esta relacionado con el tema de seguridad del barrio?'), colores, 'N√∫mero de respuestas', 'Respuesta', 200);
        // 7. Calidad de vida
        renderBar('calidadVidaBar', agruparPorCampo(data, '¬øConsidera que la acumulaci√≥n de residuos afecta su calidad de vida?'), colores, 'N√∫mero de respuestas', 'Respuesta', 200);
        // 8. Separaci√≥n de residuos
        renderBar('separacionBar', agruparPorCampo(data, '¬øSepara los residuos en su casa (org√°nicos, reciclables, no reciclables)?'), colores, 'N√∫mero de respuestas', 'Respuesta', 200);
        // 9. Conoce horario recolecci√≥n
        renderBar('horarioBar', agruparPorCampo(data, '¬øConoce el horario de recolecci√≥n de residuos en el barrio?'), colores, 'N√∫mero de respuestas', 'Respuesta', 200);
        // 10. Saca residuos en horarios
        renderBar('sacaHorariosBar', agruparPorCampo(data, '¬øSaca los residuos en los horarios establecidos?'), colores, 'N√∫mero de respuestas', 'Respuesta', 200);
        // 11. Entrega a recuperador
        renderBar('recuperadorBar', agruparPorCampo(data, '¬øEntrega sus residuos aprovechables a un recuperador de oficio?'), colores, 'Cantidad de respuestas', '', 150);
        // 12. Lugar de disposici√≥n
        const campoLugar = buscarCampo(data, [
            '¬øEn qu√© lugar dispone los residuos?',
            'En qu√© lugar dispone los residuos',
            '¬øEn que lugar dispone los residuos?', // <-- nombre exacto del Sheets
            'En que lugar dispone los residuos',
        ]);
        if (campoLugar) renderBar('lugarBar', agruparPorCampo(data, campoLugar), colores, 'Cantidad de respuestas', '', 150);
        // 13. Calificaci√≥n del servicio
        renderBar('servicioBar', agruparPorCampo(data, '¬øC√≥mo calificar√≠a la operaci√≥n del servicio de aseo de Promoambiental Distrito S.A.S?'), colores, 'Cantidad de respuestas', '', 150);
        // 14. Frecuencia cami√≥n recolector
        renderBar('frecuenciaCamionBar', agruparPorCampo(data, '¬øCon qu√© frecuencia pasa el cami√≥n recolector de residuos?'), colores, 'Cantidad de respuestas', '', 150);
        // 15. Participaci√≥n en campa√±as
        renderBar('participacionBar', agruparPorCampo(data, '¬øHa participado en alguna campa√±a de limpieza o educaci√≥n ambiental en su barrio?'), colores, 'Cantidad de respuestas', '', 150);
        // 16. Iniciativas comunitarias
        const campoIniciativas = buscarCampo(data, [
            '¬øLe gustar√≠a participar en iniciativas comunitarias de limpieza?',
            'Le gustar√≠a participar en iniciativas comunitarias de limpieza',
            '¬øLe gustaria participar en iniciativas comunitarias de limpieza?',
            'Le gustaria participar en iniciativas comunitarias de limpieza',
        ]);
        if (campoIniciativas) renderBar('iniciativasBar', agruparPorCampo(data, campoIniciativas), colores, 'Cantidad de respuestas', '', 150);
        // 17. Educaci√≥n ambiental
        renderBar('educacionBar', agruparPorCampo(data, '¬øConsidera que hace falta m√°s educaci√≥n ambiental en el barrio?'), colores, 'Cantidad de respuestas', '', 150);
        // 18. Sabe punto cr√≠tico
        const campoPuntoCritico = buscarCampo(data, [
            '¬øSabe que es un punto cr√≠tico?',
            'Sabe que es un punto cr√≠tico',
            '¬øSabe que es un punto critico?',
            'Sabe que es un punto critico',
        ]);
        if (campoPuntoCritico) renderBar('puntoCriticoBar', agruparPorCampo(data, campoPuntoCritico), colores, 'Cantidad de respuestas', '', 150);
        // 19. Identifica puntos cr√≠ticos
        renderBar('identificaBar', agruparPorCampo(data, '¬øIdentifica puntos cr√≠ticos en el barrio?'), colores, 'Cantidad de respuestas', '', 150);
        // 20. Tiempo puntos cr√≠ticos
        renderBar('tiempoPuntosBar', agruparPorCampo(data, '¬øCada cuanto tiempo ve estos puntos en el barrio?'), colores, 'Cantidad de respuestas', '', 150);
    }

    // --- Listener para el checkbox y carga de datos ---
    let datosGenerales = null;
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/el-consuelo/data')
            .then(res => res.json())
            .then(json => {
                if (json.data) {
                    datosGenerales = json.data;
                    renderGraficasResultados(datosGenerales);
                }
            });
        // Listener para el checkbox de puntos intervenidos
        document.getElementById('toggle-puntos-intervenidos').addEventListener('change', function(e) {
            const tituloResultados = document.getElementById('titulo-resultados-encuestas');
            if (e.target.checked) {
                // Filtrar por columna 'Cuadrante o zona' con valores 1,2,3,4,5,6,7,8,17,22
                const valoresValidos = ['1','2','3','4','5','6','7','8','17','22'];
                const campoCuadrante = buscarCampo(datosGenerales, ['Cuadrante o zona', 'N', 'Cuadrante']);
                if (campoCuadrante) {
                    const filtrados = datosGenerales.filter(row => valoresValidos.includes(String(row[campoCuadrante]).trim()));
                    renderGraficasResultados(filtrados);
                } else {
                    renderGraficasResultados([]); // Si no existe el campo, mostrar vac√≠o
                }
                if (tituloResultados) tituloResultados.textContent = 'Resultados de los poligonos impactados';
            } else {
                renderGraficasResultados(datosGenerales);
                if (tituloResultados) tituloResultados.textContent = 'Resultados generales de las encuestas';
            }
        });
    });
    </script>
    <script>
    // --- Interactividad del men√∫ hamburguesa ---
    const menuBtn = document.getElementById('menu-btn');
    const sideMenu = document.getElementById('side-menu');
    const menuOverlay = document.getElementById('menu-overlay');
    function openMenu() {
        sideMenu.classList.add('open');
        menuOverlay.classList.add('open');
    }
    function closeMenu() {
        sideMenu.classList.remove('open');
        menuOverlay.classList.remove('open');
    }
    menuBtn.addEventListener('click', function() {
        if (sideMenu.classList.contains('open')) {
            closeMenu();
        } else {
            openMenu();
        }
    });
    menuOverlay.addEventListener('click', function() {
        closeMenu();
    });
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      var btnIndicadores = document.getElementById('btn-indicadores-gestion');
      var modalIndicadores = document.getElementById('indicadoresModal');
      var closeIndicadores = document.getElementById('closeIndicadoresModal');
      if(btnIndicadores && modalIndicadores && closeIndicadores) {
        btnIndicadores.addEventListener('click', function() {
          modalIndicadores.style.display = 'flex';
        });
        closeIndicadores.addEventListener('click', function() {
          modalIndicadores.style.display = 'none';
        });
        modalIndicadores.addEventListener('click', function(e) {
          if (e.target === this) this.style.display = 'none';
        });
      }
    });
    </script>
    <script>
document.addEventListener('DOMContentLoaded', function() {
  var btnAcordeon = document.getElementById('btn-percepcion-limpieza');
  var contenidoAcordeon = document.getElementById('contenido-percepcion-limpieza');
  var iconoAcordeon = document.getElementById('icono-acordeon-limpieza');
  if(btnAcordeon && contenidoAcordeon && iconoAcordeon) {
    btnAcordeon.addEventListener('click', function() {
      if (contenidoAcordeon.style.display === 'none' || contenidoAcordeon.style.display === '') {
        contenidoAcordeon.style.display = 'block';
        iconoAcordeon.innerHTML = '&#9650;';
      } else {
        contenidoAcordeon.style.display = 'none';
        iconoAcordeon.innerHTML = '&#9660;';
      }
    });
  }
  // Acorde√≥n para h√°bitos personales de manejo de residuos
  var btnHabitos = document.getElementById('btn-habitos-residuos');
  var contenidoHabitos = document.getElementById('contenido-habitos-residuos');
  var iconoHabitos = document.getElementById('icono-acordeon-habitos');
  if(btnHabitos && contenidoHabitos && iconoHabitos) {
    btnHabitos.addEventListener('click', function() {
      if (contenidoHabitos.style.display === 'none' || contenidoHabitos.style.display === '') {
        contenidoHabitos.style.display = 'block';
        iconoHabitos.innerHTML = '&#9650;';
      } else {
        contenidoHabitos.style.display = 'none';
        iconoHabitos.innerHTML = '&#9660;';
      }
    });
  }
  // Acorde√≥n para opini√≥n sobre el servicio de recolecci√≥n
  var btnRecoleccion = document.getElementById('btn-opinion-recoleccion');
  var contenidoRecoleccion = document.getElementById('contenido-opinion-recoleccion');
  var iconoRecoleccion = document.getElementById('icono-acordeon-recoleccion');
  if(btnRecoleccion && contenidoRecoleccion && iconoRecoleccion) {
    btnRecoleccion.addEventListener('click', function() {
      if (contenidoRecoleccion.style.display === 'none' || contenidoRecoleccion.style.display === '') {
        contenidoRecoleccion.style.display = 'block';
        iconoRecoleccion.innerHTML = '&#9650;';
      } else {
        contenidoRecoleccion.style.display = 'none';
        iconoRecoleccion.innerHTML = '&#9660;';
      }
    });
  }
  // Acorde√≥n para participaci√≥n y educaci√≥n ambiental
  var btnParticipacion = document.getElementById('btn-participacion-educacion');
  var contenidoParticipacion = document.getElementById('contenido-participacion-educacion');
  var iconoParticipacion = document.getElementById('icono-acordeon-participacion');
  if(btnParticipacion && contenidoParticipacion && iconoParticipacion) {
    btnParticipacion.addEventListener('click', function() {
      if (contenidoParticipacion.style.display === 'none' || contenidoParticipacion.style.display === '') {
        contenidoParticipacion.style.display = 'block';
        iconoParticipacion.innerHTML = '&#9650;';
      } else {
        contenidoParticipacion.style.display = 'none';
        iconoParticipacion.innerHTML = '&#9660;';
      }
    });
  }
});
</script>

<!-- Modal para Ruta Metodol√≥gica -->
<div id="modalRutaMetodologica" class="modal-indicadores" style="display:none;">
  <div class="modal-content-indicadores" style="max-width:700px; max-height:80vh; overflow-y:auto;">
    <span class="close-modal-indicadores" id="closeRutaMetodologica">&times;</span>
    <h2 style="color:var(--primary-red); text-align:center; margin-bottom:1.5rem;">Ruta Metodol√≥gica</h2>
    <div class="timeline-metodologia">
      <div class="timeline-step">
        <div class="timeline-circle">1</div>
        <div class="timeline-content">
          <b>Diagn√≥stico de identificaci√≥n de puntos cr√≠ticos</b><br>
          <b>Recursos log√≠sticos:</b> Mapa del sector, celular para el registro fotogr√°fico con GPS.<br>
          <b>Tiempo:</b> 1 d√≠a de disponibilidad.<br>
          <b>Recurso humano:</b> 1 profesional ambiental, 1 gestor ambiental (Alcald√≠a Local).
        </div>
      </div>
      <div class="timeline-step">
        <div class="timeline-circle">2</div>
        <div class="timeline-content">
          <b>Levantamiento de Bit√°cora para la verificaci√≥n del comportamiento de los puntos</b><br>
          <b>Recursos log√≠sticos:</b> Bit√°cora, Celular con acceso a internet.<br>
          <b>Tiempo:</b> 1 semana de lunes a domingo.<br>
          <b>Recurso humano:</b> 1 profesional ambiental, 4 gestores (Alcald√≠a Local) por d√≠a en un turno de 9 am a 4 pm.
        </div>
      </div>
      <div class="timeline-step">
        <div class="timeline-circle">3</div>
        <div class="timeline-content">
          <b>Levantamiento de encuestas de percepci√≥n</b><br>
          <b>Recursos log√≠sticos:</b> Encuesta impresa, tablas para apoyar, esferos, guion de ejecuci√≥n de la encuesta.<br>
          <b>Tiempo:</b> 1 semana de lunes a domingo (dependiendo el pol√≠gono identificado).<br>
          <b>Recurso humano:</b> 1 profesional ambiental, 4 gestores (Alcald√≠a Local) por d√≠a en un turno de 9 am a 4 pm.
        </div>
      </div>
      <div class="timeline-step">
        <div class="timeline-circle">4</div>
        <div class="timeline-content">
          <b>Sistematizaci√≥n y an√°lisis de informaci√≥n y georreferenciaci√≥n</b><br>
          <b>Recursos log√≠sticos:</b> Tablas Excel.<br>
          <b>Tiempo:</b> 4 d√≠as.<br>
          <b>Recurso humano:</b> 1 profesional ambiental, 4 gestores por d√≠a (Alcald√≠a Local).
        </div>
      </div>
      <div class="timeline-step">
        <div class="timeline-circle">5</div>
        <div class="timeline-content">
          <b>Proyecci√≥n Plan de Trabajo</b><br>
          <b>Recursos log√≠sticos:</b> No aplica.<br>
          <b>Tiempo:</b> 1 d√≠a.<br>
          <b>Recurso humano:</b> 1 profesional ambiental (Alcald√≠a Local) y entidades de orden local y distrital.
        </div>
      </div>
      <div class="timeline-step">
        <div class="timeline-circle">6</div>
        <div class="timeline-content">
          <b>Ejecuci√≥n Plan de Trabajo</b><br>
          <b>Recursos log√≠sticos:</b> Depende de las actividades planteadas.<br>
          <b>Tiempo:</b> 3 semanas.<br>
          <b>Recurso humano:</b> 1 profesional ambiental (Alcald√≠a Local) y entidades de orden local y distrital.
        </div>
      </div>
      <div class="timeline-step">
        <div class="timeline-circle">7</div>
        <div class="timeline-content">
          <b>Levantamiento de encuestas de percepci√≥n</b><br>
          <b>Recursos log√≠sticos:</b> Encuesta impresa, tablas para apoyar, esferos, guion de ejecuci√≥n de la encuesta.<br>
          <b>Tiempo:</b> 1 semana de lunes a domingo (dependiendo el pol√≠gono identificado).<br>
          <b>Recurso humano:</b> 1 profesional ambiental, 4 gestores (Alcald√≠a Local) por d√≠a en un turno de 9 am a 4 pm.
        </div>
      </div>
      <div class="timeline-step">
        <div class="timeline-circle">8</div>
        <div class="timeline-content">
          <b>Evaluaci√≥n de resultados (sistematizaci√≥n y comparaci√≥n)</b><br>
          <b>Recursos log√≠sticos:</b> No aplica.<br>
          <b>Tiempo:</b> 3 d√≠as.<br>
          <b>Recurso humano:</b> 1 profesional ambiental, 1 gestor ambiental (Alcald√≠a Local).
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.timeline-metodologia {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  margin: 1.5rem 0;
}
.timeline-step {
  display: flex;
  align-items: flex-start;
  gap: 1.2rem;
}
.timeline-circle {
  min-width: 38px;
  min-height: 38px;
  background: var(--primary-red);
  color: #fff;
  border-radius: 50%;
  font-size: 1.3rem;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  margin-top: 2px;
}
.timeline-content {
  background: #f9f9f9;
  border-radius: 10px;
  padding: 1rem 1.2rem;
  border-left: 4px solid var(--primary-yellow);
  font-size: 1.05rem;
  flex: 1;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var btnRuta = document.getElementById('btn-ruta-metodologica');
  var modalRuta = document.getElementById('modalRutaMetodologica');
  var closeRuta = document.getElementById('closeRutaMetodologica');
  if(btnRuta && modalRuta && closeRuta) {
    btnRuta.addEventListener('click', function() {
      modalRuta.style.display = 'flex';
    });
    closeRuta.addEventListener('click', function() {
      modalRuta.style.display = 'none';
    });
    modalRuta.addEventListener('click', function(e) {
      if (e.target === this) this.style.display = 'none';
    });
  }
});
</script>

<!-- Modal para Plan de Trabajo -->
<div id="modalPlanTrabajo" class="modal-indicadores" style="display:none;">
  <div class="modal-content-indicadores" style="max-width:500px;">
    <span class="close-modal-indicadores" id="closePlanTrabajo">&times;</span>
    <h2 style="color:var(--primary-red); text-align:center; margin-bottom:1.5rem;">Plan de Trabajo - Documentos</h2>
    <ul style="font-size:1.15rem;">
      <li><a href="/static/docs/PI%20Puntos%201%20Y%2015.xlsx" download>Descargar PI Puntos 1 Y 15.xlsx</a></li>
      <li><a href="/static/docs/PI%20Puntos%203%20Y%206.xlsx" download>Descargar PI Puntos 3 Y 6.xlsx</a></li>
    </ul>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var btnPlan = document.getElementById('btn-plan-trabajo');
  var modalPlan = document.getElementById('modalPlanTrabajo');
  var closePlan = document.getElementById('closePlanTrabajo');
  if(btnPlan && modalPlan && closePlan) {
    btnPlan.addEventListener('click', function() {
      modalPlan.style.display = 'flex';
    });
    closePlan.addEventListener('click', function() {
      modalPlan.style.display = 'none';
    });
    modalPlan.addEventListener('click', function(e) {
      if (e.target === this) this.style.display = 'none';
    });
  }
});
</script>

<!-- Modal para An√°lisis del ejercicio -->
<div id="modalAnalisisEjercicio" class="modal-indicadores" style="display:none;">
  <div class="modal-content-indicadores" style="max-width:700px; max-height:80vh; overflow-y:auto;">
    <span class="close-modal-indicadores" id="closeAnalisisEjercicio">&times;</span>
    <h2 style="color:var(--primary-red); text-align:center; margin-bottom:1.5rem;">An√°lisis del ejercicio</h2>
    <ol style="font-size:1.08rem; padding-left:1.2em;">
      <li><b>Condiciones f√≠sicas deterioradas</b>
        <ul><li>Todos los puntos presentan andenes en mal estado, lo cual no solo afecta la movilidad, sino que genera espacios propensos a ser usados como botaderos.</li></ul>
      </li>
      <li><b>Falta o inconsistencia en se√±alizaci√≥n</b>
        <ul><li>En 3 de los 4 casos, no hay letreros visibles de prohibido arrojar basura o est√°n en mal estado, lo cual reduce el efecto disuasivo en el comportamiento de los residentes.</li></ul>
      </li>
      <li><b>Entorno mixto (residencial y comercial)</b>
        <ul>
          <li>Los cuatro puntos est√°n rodeados por zonas residenciales y comerciales, lo que incrementa la generaci√≥n de residuos y dificulta su control si no hay cultura ciudadana o vigilancia.</li>
          <li>En menos de 200 metros a la redonda de los puntos cr√≠ticos, existe bater√≠a institucional (Colegio Aulas Colombianas, Parque, Sal√≥n Comunal y CAI El Dorado)</li>
        </ul>
      </li>
      <li><b>Dep√≥sito comunitario de residuos</b>
        <ul><li>En todos los puntos, se identifica a la comunidad como la principal responsable del dep√≥sito de residuos. Esto evidencia la falta de apropiaci√≥n colectiva del espacio p√∫blico.</li></ul>
      </li>
      <li><b>Problemas de salud y movilidad</b>
        <ul>
          <li>Se evidenciaron vectores (moscas, roedores) y olores desagradables en al menos 6 ocasiones en cada punto. Esto representa un riesgo para la salud p√∫blica.</li>
          <li>Dificultad en la movilidad peatonal y vehicular en todos los casos, con obstrucci√≥n del espacio p√∫blico.</li>
          <li>En los d√≠as de servicio de barrido y limpieza se evidencia que se dejan bolsas del operador de aseo exactamente donde se encuentran los puntos cr√≠ticos, siendo estos los primeros en incentivar una percepci√≥n de equivocada de horarios no establecidos y de lugares leg√≠timos para la disposici√≥n de residuos.</li>
        </ul>
      </li>
      <li><b>Bajo aprovechamiento de residuos</b>
        <ul><li>Recuperadores de oficio fueron observados solo en 1 o 2 ocasiones por punto, lo cual refleja que los residuos reciclables no est√°n siendo clasificados ni aprovechados de forma regular.</li></ul>
      </li>
      <li><b>Escasa presencia de estrategias de control</b>
        <ul>
          <li>En ning√∫n punto se evidencian cazaregueros ni otras intervenciones comunitarias permanentes que eviten la consolidaci√≥n del punto cr√≠tico.</li>
          <li>El servicio de barrido y limpieza fue intermitente, reportado entre 4 y 6 veces por semana.</li>
        </ul>
      </li>
      <li><b>Percepci√≥n de residuos en el barrio:</b>
        <ul style="margin-bottom:0.7em;">
          <li>Existe una percepci√≥n negativa de limpieza en el barrio, cerca de 150 de 222 encuestadas en estos puntos cr√≠ticos opinan que la limpieza est√° entre los valores 1,2 y 3. Misma tendencia que se replica en todos los pol√≠gonos del barrio (381 de 349).</li>
          <li>Del mismo modo, la ciudadan√≠a observa siempre (160), frecuentemente (48) y a veces (10) residuos en la calle. Y est√° fuertemente relacionado con la percepci√≥n que tiene de la seguridad del barrio (184 de 222) y con la afectaci√≥n en la calidad de vida (214 de 222). Misma tendencia en los dem√°s pol√≠gonos del barrio (430 aproximadamente de 439).</li>
          <li>158 de 222 personas encuestadas siempre separan los residuos de su casa, 41 nunca y 23 personas a veces lo hacen. Esta misma tendencia se replica en todos los pol√≠gonos del barrio (313 de 439 siempre lo hacen).</li>
          <li>Hay 181 personas encuestadas de 222 personas, que conocen el horario de recolecci√≥n. Sin embargo 32 personas no lo conocen. Adicionalmente, 203 personas de las 222 encuestadas sacan la basura en los horarios establecidos. Esta misma tendencia se ve reflejada en todos los dem√°s pol√≠gonos del barrio. Es decir, la mayor√≠a de las personas conocen los horarios de recolecci√≥n, pero un porcentaje de 15% aproximadamente no conoce los horarios.</li>
          <li>Por otro lado, 118 personas encuestadas sacan sus residuos al frente de su casa, 99 personas encuestadas la sacan a la esquina de la cuadra. Esta misma tendencia se replica en todos los pol√≠gonos del barrio (426 de 439).</li>
          <li>El 58% de las personas encuestadas califican el servicio de Promoambiental Distrito S.A.S entre 1 y 3. Porcentaje cercano a la tendencia global del barrio en todos sus pol√≠gonos con un 53.5%, que tambi√©n califica el servicio de aseo entre 1 y 3.</li>
          <li>El 72% de las personas manifiesta no haber participado en ninguna campa√±a de limpieza o educaci√≥n ambiental. En t√©rminos generales del barrio, el 74% argumenta no haber participado en ninguna campa√±a educativa.</li>
        </ul>
      </li>
    </ol>
    <div style="background:#f3f3f3; border-left:5px solid var(--primary-yellow); border-radius:8px; padding:1.2em 1.5em; margin-top:2em;">
      <h3 style="color:var(--primary-red); font-size:1.2rem; margin-bottom:0.7em;">Conclusiones generales para la formulaci√≥n del Plan de Trabajo</h3>
      <ol style="font-size:1.08rem; padding-left:1.2em;">
        <li>Los puntos cr√≠ticos tienen una fuerte relaci√≥n con el comportamiento comunitario: la falta de cultura ciudadana, sumada a la poca vigilancia, contribuye a que los residentes depositen residuos de forma continua.</li>
        <li>La ausencia de infraestructura adecuada y mantenimiento del espacio p√∫blico (andenes, se√±alizaci√≥n) refuerza el uso informal del √°rea como botadero.</li>
        <li>La cercan√≠a a zonas comerciales y de alta circulaci√≥n humana intensifica el problema, al aumentar el flujo de residuos y dificultar el control.</li>
        <li>Los puntos cr√≠ticos no est√°n siendo abordados con estrategias sostenidas de recuperaci√≥n: la limpieza es eventual, y no hay acompa√±amiento de educaci√≥n ambiental, monitoreo ni control.</li>
        <li>Existe una oportunidad de intervenci√≥n social y t√©cnica: fomentar campa√±as de educaci√≥n ambiental, instalar se√±alizaci√≥n clara, mejorar la infraestructura y fortalecer la presencia de recuperadores o gestores comunitarios podr√≠a transformar estos espacios.</li>
        <li>Es pertinente establecer medidas correctivas como operativos de IVC y sanciones de acuerdo a las Ley 1801 de 2016.</li>
      </ol>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var btnAnalisis = document.getElementById('btn-analisis-ejercicio');
  var modalAnalisis = document.getElementById('modalAnalisisEjercicio');
  var closeAnalisis = document.getElementById('closeAnalisisEjercicio');
  if(btnAnalisis && modalAnalisis && closeAnalisis) {
    btnAnalisis.addEventListener('click', function() {
      modalAnalisis.style.display = 'flex';
    });
    closeAnalisis.addEventListener('click', function() {
      modalAnalisis.style.display = 'none';
    });
    modalAnalisis.addEventListener('click', function(e) {
      if (e.target === this) this.style.display = 'none';
    });
  }
});
</script>

<!-- Modal para 4 comportamientos de indicadores de gesti√≥n -->
<div id="modalComportamientosIndicadores" class="modal-indicadores" style="display:none;">
  <div class="modal-content-indicadores" style="max-width:700px; max-height:80vh; overflow-y:auto;">
    <span class="close-modal-indicadores" id="closeComportamientosIndicadores">&times;</span>
    <h2 style="color:var(--primary-red); text-align:center; margin-bottom:1.5rem;">4 comportamientos de indicadores de gesti√≥n</h2>
    <div id="barrasComportamientos" style="height:340px; margin-bottom:2rem;"></div>
    <div style="font-size:1.08rem;">
      <div style="margin-bottom:1.2em;">
        <b>Indicador 1: Percepci√≥n sobre limpieza del barrio</b><br>
        <span style="color:var(--primary-yellow); font-weight:600;">General:</span> 177/439 = 40%<br>
        <span style="color:var(--primary-yellow); font-weight:600;">Espec√≠fico:</span> 84/222 = 37%<br>
        <span style="color:#333;">40% de toda la poblaci√≥n encuestada en todos los pol√≠gonos del barrio manifiestan que la percepci√≥n del aseo es negativa.<br>37% de toda la poblaci√≥n encuestada en los pol√≠gonos a intervenir manifiestan que la percepci√≥n del aseo es negativa.</span>
      </div>
      <div style="margin-bottom:1.2em;">
        <b>Indicador 2: H√°bitos personales de manejo de residuos</b><br>
        <span style="color:var(--primary-yellow); font-weight:600;">General:</span> 358/439 = 81%<br>
        <span style="color:var(--primary-yellow); font-weight:600;">Espec√≠fico:</span> 185/222 = 83%<br>
        <span style="color:#333;">Buen nivel de adopci√≥n de pr√°cticas responsables.</span>
      </div>
      <div style="margin-bottom:1.2em;">
        <b>Indicador 3: Opini√≥n sobre el servicio de recolecci√≥n</b><br>
        <span style="color:var(--primary-yellow); font-weight:600;">General:</span> 92/439 = 21%<br>
        <span style="color:var(--primary-yellow); font-weight:600;">Espec√≠fico:</span> 92/222 = 41%<br>
        <span style="color:#333;">En t√©rminos generales del barrio existe un bajo nivel de satisfacci√≥n con el servicio de recolecci√≥n de residuos.<br>En los pol√≠gonos a intervenir existe un nivel medio de satisfacci√≥n con el servicio de recolecci√≥n de residuos.</span>
      </div>
      <div style="margin-bottom:1.2em;">
        <b>Indicador 4: Participaci√≥n y Educaci√≥n ambiental</b><br>
        <span style="color:var(--primary-yellow); font-weight:600;">General:</span> 368/439 = 83%<br>
        <span style="color:var(--primary-yellow); font-weight:600;">Espec√≠fico:</span> 189/222 = 85.1%<br>
        <span style="color:#333;">En t√©rminos generales del barrio existe un alto nivel de compromiso e informaci√≥n ambiental.<br>En los pol√≠gonos intervenidos existe un alto nivel de compromiso con la situaci√≥n ambiental y de residuos.</span>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var btnComportamientos = document.getElementById('btn-comportamientos-indicadores');
  var modalComportamientos = document.getElementById('modalComportamientosIndicadores');
  var closeComportamientos = document.getElementById('closeComportamientosIndicadores');
  if(btnComportamientos && modalComportamientos && closeComportamientos) {
    btnComportamientos.addEventListener('click', function() {
      modalComportamientos.style.display = 'flex';
      // Renderizar la gr√°fica solo cuando se abre el modal
      Plotly.newPlot('barrasComportamientos', [
        {
          y: ['Indicador 1', 'Indicador 2', 'Indicador 3', 'Indicador 4'],
          x: [40, 81, 21, 83],
          name: 'General',
          type: 'bar',
          orientation: 'h',
          marker: {color: '#fab62d'},
          text: ["40%", "81%", "21%", "83%"],
          textposition: 'inside',
          insidetextanchor: 'middle',
          textfont: {size: 13, color: '#333'}
        },
        {
          y: ['Indicador 1', 'Indicador 2', 'Indicador 3', 'Indicador 4'],
          x: [37, 83, 41, 85.1],
          name: 'Espec√≠fico',
          type: 'bar',
          orientation: 'h',
          marker: {color: '#e4032e'},
          text: ["37%", "83%", "41%", "85.1%"],
          textposition: 'inside',
          insidetextanchor: 'middle',
          textfont: {size: 13, color: '#fff'}
        }
      ], {
        barmode: 'group',
        xaxis: {title: 'Porcentaje (%)', range: [0, 100], tickfont: {size: 11}},
        yaxis: {title: ''},
        legend: {orientation: 'h', y: -0.2},
        margin: {t: 30, b: 60, l: 100, r: 20},
        height: 340,
        plot_bgcolor: '#fff',
        paper_bgcolor: '#fff',
        font: {family: 'Inter, sans-serif', size: 14}
      }, {responsive: true});
    });
    closeComportamientos.addEventListener('click', function() {
      modalComportamientos.style.display = 'none';
    });
    modalComportamientos.addEventListener('click', function(e) {
      if (e.target === this) this.style.display = 'none';
    });
  }
});
</script>

<!-- Modal para Caja de Herramientas -->
<div id="modalCajaHerramientas" class="modal-indicadores" style="display:none;">
  <div class="modal-content-indicadores" style="max-width:500px;">
    <span class="close-modal-indicadores" id="closeCajaHerramientas">&times;</span>
    <h2 style="color:var(--primary-red); text-align:center; margin-bottom:1.5rem;">Caja de Herramientas</h2>
    <ul style="font-size:1.15rem;">
      <li><a href="/static/docs/BIT√ÅCORA%20PUNTOS%20CR√çTICOS%20CONSUELO%20-%20Formularios%20de%20Google.pdf" download>Descargar BIT√ÅCORA PUNTOS CR√çTICOS CONSUELO - Formularios de Google.pdf</a></li>
      <li><a href="/static/docs/Bolsa%20de%20Actividades_Propuesta.xlsx" download>Descargar Bolsa de Actividades_Propuesta.xlsx</a></li>
      <li><a href="/static/docs/Encuesta%20Ajustes.pdf" download>Descargar Encuesta Ajustes.pdf</a></li>
      <li><a href="/static/docs/Encuesta%20versi√≥n%201.pdf" download>Descargar Encuesta versi√≥n 1.pdf</a></li>
    </ul>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var btnCaja = document.getElementById('btn-caja-herramientas');
  var modalCaja = document.getElementById('modalCajaHerramientas');
  var closeCaja = document.getElementById('closeCajaHerramientas');
  if(btnCaja && modalCaja && closeCaja) {
    btnCaja.addEventListener('click', function() {
      modalCaja.style.display = 'flex';
    });
    closeCaja.addEventListener('click', function() {
      modalCaja.style.display = 'none';
    });
    modalCaja.addEventListener('click', function(e) {
      if (e.target === this) this.style.display = 'none';
    });
  }
});
</script>

<script>
// --- Bater√≠a social ---
let bateriaSocialLayer = null;
document.getElementById('toggle-bateria-social').addEventListener('change', function(e) {
    if (e.target.checked) {
        if (!bateriaSocialLayer) {
            bateriaSocialLayer = omnivore.kml('/static/data/Bateria_social.kml')
                .on('ready', function() {
                    // Puedes ajustar el estilo aqu√≠ si lo deseas
                    this.eachLayer(function(layer) {
                        if (layer.setStyle) {
                            layer.setStyle({color: '#4ECDC4', weight: 3, fillOpacity: 0.5});
                        }
                    });
                })
                .addTo(map);
        } else {
            bateriaSocialLayer.addTo(map);
        }
    } else {
        if (bateriaSocialLayer) {
            map.removeLayer(bateriaSocialLayer);
        }
    }
});
</script>
</body>
</html> 